import{d as se,r as v,u as de,a as P,$ as re,a0 as ie,a1 as pe,o as me,E as _e,b as ce,c as fe,Y as Fe,Z as ge,v as ve,k as c,l as h,m as V,n as u,w as o,p,F as x,z as O,s as E,q as Be,A as _,t as R,y as I,B as m,C as be,D as Ee,G as De,H as ke,I as ze,W as Ce,X as ye,J as we,K as Ae,L as he}from"./index.9941ee4c.js";import{u as Ve}from"./page.e14ee017.js";/* empty css                   *//* empty css                          *//* empty css                 *//* empty css                  *//* empty css               *//* empty css                     */import{u as xe}from"./cid.14c1a544.js";import{e as Ie}from"./export2excel.b0094550.js";import{m as L,n as je,o as Se,p as Ue,q as qe}from"./cid.b8acbdfd.js";const Pe={class:"container"},Oe=_("\u6DFB\u52A0\u8D26\u6237"),Re=_("\u5BFC\u51FA"),Le=_("\u67E5\u8BE2"),Ne=_("\u91CD\u7F6E"),Te=_("\u8FDB\u5165\u8D26\u53F7"),$e=_("\u7F16\u8F91"),Ze=_("\u5220\u9664"),Je={class:"pagination"},Me={class:"dialog-footer"},Ge=_("\u53D6\u6D88"),He=_("\u786E\u8BA4"),sa=se({__name:"customer",setup(Ke){const D=v(),F=xe(),N=de(),k=v(!1),B=v(!1),z=P({platform:""}),y=v({id:0}),j=re();v("1");const T=ie(),$=pe(),e=v({nickname:"",username:"",password:"",taobao_adzone_id:"",jd_adzone_id:"",pdd_adzone_id:"",email:"",platform:["0"]}),g=P({nickname:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BA2\u6237\u540D\u79F0",trigger:"blur"}],username:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D26\u53F7",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u586B\u5199\u81F3\u5C116\u4F4D\u5BC6\u7801",trigger:"blur",min:6}],platform:[{required:!0,message:"\u8BF7\u9009\u62E9\u5E73\u53F0",trigger:"blur"}],taobao_adzone_id:[{required:!0,message:"\u8BF7\u8F93\u5165\u6DD8\u5B9D\u63A8\u5E7F\u4F4DPID",trigger:"blur"}],jd_adzone_id:[],pdd_adzone_id:[],email:[{validator:(t,a,s)=>{const r=e.value.email,n=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;if(!r)return s();n.test(r)?s():s(new Error("\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E"))},trigger:"blur"}]}),w=v(!1),{query:d,goPage:Z,goInit:C}=Ve(()=>S()),S=()=>{w.value=!0,L({platform:z.platform,page_index:d.page,page_size:d.page_size,keyword:d.keyword}).then(t=>{w.value=!1,d.list=t.data.lists,d.total=t.data.total_count}).catch(()=>{w.value=!1})};me(()=>{S()});const J=()=>{var t;e.value.platform.includes("0")?g.taobao_adzone_id=[{required:!0,message:"\u8BF7\u8F93\u5165\u6DD8\u5B9D\u63A8\u5E7F\u4F4DPID",trigger:"blur"}]:(g.taobao_adzone_id=[],e.value.taobao_adzone_id=""),e.value.platform.includes("1")?g.jd_adzone_id=[{required:!0,message:"\u8BF7\u8F93\u5165\u4EAC\u4E1C\u63A8\u5E7F\u4F4DPID",trigger:"blur"}]:(g.jd_adzone_id=[],e.value.jd_adzone_id=""),e.value.platform.includes("2")?g.pdd_adzone_id=[{required:!0,message:"\u8BF7\u8F93\u5165\u62FC\u591A\u591A\u63A8\u5E7F\u4F4DPID",trigger:"blur"}]:(g.pdd_adzone_id=[],e.value.pdd_adzone_id=""),(t=D.value)==null||t.clearValidate()},M=t=>{je({id:t.id}).then(a=>{if(a.status==200){localStorage.setItem("token",a.data.token),localStorage.setItem("ms_cid_userinfo",JSON.stringify(a.data)),localStorage.setItem("ms_cid_userinfo_username",a.data.nickname);const s=j.defaultList[a.data.permission===0?"admin":"user"];j.handleSet(s),localStorage.setItem("ms_keys",JSON.stringify(s)),T.setUserinfo(),$.clearTags(),N.push(a.data.permission===0?"/cid_goods":"/cid_goods_tb")}}).catch(a=>{m.error(a.message)})},G=()=>{d.keyword="",z.platform="",C()},H=()=>{L({platform:z.platform,page_index:d.page,page_size:1e4,keyword:d.keyword}).then(t=>{if(t.status==200){const a=t.data.lists.map(r=>{const n=F.platformOptions.find(i=>i.value==r.platform);return{username:r.username,nickname:r.nickname,email:r.email,platform:n?n.label:"",ocean_engine_account:r.ocean_engine_account}}),s=["\u5BA2\u6237\u8D26\u53F7","\u5BA2\u6237\u540D\u79F0","\u90AE\u7BB1","\u9500\u552E\u5E73\u53F0","\u5A92\u4F53\u8D26\u53F7"];console.log(a),Ie(a,"\u5BA2\u6237\u5217\u8868",s,"\u5BA2\u6237\u5217\u8868")}else m.error(t.message||"\u540E\u7AEFapi\u63A5\u53E3\u5F02\u5E38\uFF01")}).catch(t=>{m.error(t.message)})},A=()=>{var t;D&&((t=D.value)==null||t.resetFields()),k.value=!1,e.value.nickname="",e.value.username="",e.value.password="",e.value.taobao_adzone_id="",e.value.jd_adzone_id="",e.value.pdd_adzone_id="",e.value.email="",e.value.platform=["0"],y.value.id=0},K=async t=>{!t||await t.validate((a,s)=>{if(a){if(B.value)return;B.value=!0;const r={nickname:e.value.nickname,username:e.value.username,password:e.value.password,taobao_adzone_id:e.value.taobao_adzone_id,jd_adzone_id:e.value.jd_adzone_id,pdd_adzone_id:e.value.pdd_adzone_id,email:e.value.email,platform:e.value.platform.join(",")};y.value.id?Se({id:y.value.id,...r}).then(n=>{A(),B.value=!1,n.status==200&&(m.success("\u7F16\u8F91\u6210\u529F"),C())}).catch(n=>{B.value=!1,m.error(n.message)}):Ue({...r}).then(n=>{B.value=!1,A(),n.status==200&&(m.success("\u6DFB\u52A0\u6210\u529F"),C())}).catch(n=>{B.value=!1,m.error(n.message)})}else m.error("\u8BF7\u5C06\u4FE1\u606F\u586B\u5199\u5B8C\u6574")})},W=()=>{k.value=!0,F.setOperation("")},X=t=>{k.value=!0,F.setOperation("edit"),y.value={...t},e.value.nickname=t.nickname,e.value.username=t.username,e.value.password=t.password,e.value.taobao_adzone_id=t.taobao_adzone_id,e.value.jd_adzone_id=t.jd_adzone_id,e.value.pdd_adzone_id=t.pdd_adzone_id,e.value.email=t.email,e.value.platform=t.platform},Y=t=>{be.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","\u63D0\u793A",{type:"warning"}).then(()=>{qe({username:t.username}).then(a=>{a.status==200?(m.success("\u5220\u9664\u6210\u529F"),C()):m.error(a.message)}).catch(a=>{m.error(a.message)})}).catch(()=>{})};return(t,a)=>{const s=Ee,r=De,n=ke,i=ze,Q=Ce,ee=ye,U=we,q=Ae,b=_e,ae=ce,ue=fe,le=Fe,oe=ge,te=he,ne=ve;return c(),h(x,null,[V("div",Pe,[u(q,{justify:"space-between",align:"middle",class:"top-search"},{default:o(()=>[u(r,{span:6},{default:o(()=>[u(s,{type:"primary",onClick:W},{default:o(()=>[Oe]),_:1}),u(s,{type:"success",onClick:H},{default:o(()=>[Re]),_:1})]),_:1}),u(r,{span:18},{default:o(()=>[u(q,{justify:"end"},{default:o(()=>[u(U,{class:"",inline:!0},{default:o(()=>[u(i,{label:"\u5BA2\u6237\u540D\u79F0/\u8D26\u53F7",style:{width:"200px"}},{default:o(()=>[u(n,{modelValue:p(d).keyword,"onUpdate:modelValue":a[0]||(a[0]=l=>p(d).keyword=l),placeholder:"\u8BF7\u8F93\u5165",clearable:""},null,8,["modelValue"])]),_:1}),u(i,{label:"\u9500\u552E\u5E73\u53F0",style:{width:"200px"}},{default:o(()=>[u(ee,{modelValue:z.platform,"onUpdate:modelValue":a[1]||(a[1]=l=>z.platform=l),class:"",placeholder:"\u8BF7\u9009\u62E9",size:"default"},{default:o(()=>[(c(!0),h(x,null,O(p(F).platformOptions,l=>(c(),E(Q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(i,null,{default:o(()=>[u(s,{type:"primary",onClick:p(C),icon:"Search"},{default:o(()=>[Le]),_:1},8,["onClick"]),u(s,{type:"info",onClick:G,icon:"RefreshRight"},{default:o(()=>[Ne]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),Be((c(),E(ae,{data:p(d).list,border:""},{default:o(()=>[u(b,{prop:"username",label:"\u5BA2\u6237\u8D26\u53F7",width:"",align:"center"}),u(b,{prop:"nickname",width:"",label:"\u5BA2\u6237\u540D\u79F0",align:"center"}),u(b,{prop:"email",width:"",label:"\u90AE\u7BB1",align:"center"}),u(b,{prop:"",width:"",label:"\u9500\u552E\u5E73\u53F0",align:"center"},{default:o(l=>[_(R(p(F).platformOptions.filter(f=>l.row.platform.includes(f.value)).map(f=>f.label).join(",")),1)]),_:1}),u(b,{prop:"ocean_engine_account",width:"",label:"\u5A92\u4F53\u8D26\u53F7",align:"center"}),u(b,{label:"\u64CD\u4F5C",align:"center","min-width":"",fixed:"right"},{default:o(l=>[u(s,{type:"primary",link:"",onClick:f=>M(l.row)},{default:o(()=>[Te]),_:2},1032,["onClick"]),u(s,{type:"primary",link:"",onClick:f=>X(l.row)},{default:o(()=>[$e]),_:2},1032,["onClick"]),u(s,{type:"warning",link:"",onClick:f=>Y(l.row)},{default:o(()=>[Ze]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,w.value]]),V("div",Je,[u(ue,{background:"",layout:"total, prev, pager, next","current-page":p(d).page,"page-size":p(d).page_size,total:p(d).total,onCurrentChange:p(Z)},null,8,["current-page","page-size","total","onCurrentChange"])])]),u(te,{modelValue:k.value,"onUpdate:modelValue":a[11]||(a[11]=l=>k.value=l),title:p(F).operation=="edit"?"\u7F16\u8F91":"\u65B0\u589E",onClosed:A},{footer:o(()=>[V("span",Me,[u(s,{type:"",onClick:A},{default:o(()=>[Ge]),_:1}),u(s,{type:"primary",onClick:a[10]||(a[10]=l=>K(D.value))},{default:o(()=>[He]),_:1})])]),default:o(()=>[u(U,{class:"common-form",ref_key:"ruleFormRef",ref:D,model:e.value,rules:g,"label-width":"200px"},{default:o(()=>[u(i,{label:"\u5BA2\u6237\u540D\u79F0",prop:"nickname"},{default:o(()=>[u(n,{type:"text",modelValue:e.value.nickname,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.nickname=l),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1}),u(i,{label:"\u8D26\u53F7",prop:"username"},{default:o(()=>[u(n,{type:"text",modelValue:e.value.username,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.username=l),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1}),u(i,{label:"\u5BC6\u7801",prop:"password"},{default:o(()=>[u(n,{type:"password",modelValue:e.value.password,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.password=l),placeholder:"\u8BF7\u8F93\u5165",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),u(i,{label:"\u63A8\u5E7F\u5E73\u53F0",prop:"platform"},{default:o(()=>[u(oe,{modelValue:e.value.platform,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.platform=l),class:"ml-4",onChange:J},{default:o(()=>[(c(!0),h(x,null,O(p(F).platformOptions,(l,f)=>(c(),E(le,{label:l.value,size:"large",key:f},{default:o(()=>[_(R(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.value.platform.includes("0")?(c(),E(i,{key:0,label:"\u6DD8\u5B9D\u63A8\u5E7F\u4F4DPID",prop:"taobao_adzone_id"},{default:o(()=>[u(n,{type:"text",modelValue:e.value.taobao_adzone_id,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.taobao_adzone_id=l),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1})):I("",!0),e.value.platform.includes("1")?(c(),E(i,{key:1,label:"\u4EAC\u4E1C\u63A8\u5E7F\u4F4DPID",prop:"jd_adzone_id"},{default:o(()=>[u(n,{type:"text",modelValue:e.value.jd_adzone_id,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.jd_adzone_id=l),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1})):I("",!0),e.value.platform.includes("2")?(c(),E(i,{key:2,label:"\u62FC\u591A\u591A\u63A8\u5E7F\u4F4DPID",prop:"pdd_adzone_id"},{default:o(()=>[u(n,{type:"text",modelValue:e.value.pdd_adzone_id,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.pdd_adzone_id=l),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1})):I("",!0),u(i,{label:"\u90AE\u7BB1",prop:"email"},{default:o(()=>[u(n,{type:"text",modelValue:e.value.email,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.email=l),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}});export{sa as default};
